<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap>

    <select id = "GetCodbPrerequisiteData.effonl.RetrieveContractData" parameterClass = "String" resultClass="java.util.HashMap">
        SELECT /* GetCodbPrerequisiteData.effonl.RetrieveContractData */   
        PC.PRODUCT_CODE, PROD.BILLING_NAME_2 AS PRODUCT_NAME, C.CLASSIFICATION_RD,
		PROD.ALT_BILLING_NAME_2 AS ALT_PRODUCT_NAME, PC.PRODUCT_VERSION_CODE, 
        PC.PRICING_STRUCTURE_CODE, PRICING.NAME AS PRICING_STRUCTURE_NAME, PC.CONTRACT_NUMBER,
        SS.SERVICE_CODE,GR.ACCOUNT_NUMBER
        FROM 
            SERVICE_SUBSCRIPTION ss,
            GUIDING_RULE GR,
            PRODUCT_SUBSCRIPTION PS, 
            PRODUCT_VERSION PROD, 
            PRICING_STRUCTURE PRICING, 
            ORDER_FORM_PRODUCT_COMMIT PC,
			CUSTOMER C 
        WHERE  
        SS.SERVICE_SUBSCRIPTION_ID = #value# 
        AND GR.SERVICE_SUBSCRIPTION_ID = #value# 
        AND GR.EFFECTIVE_FLAG = 'N'
        AND GR.EFFECTIVE_STATUS = 'ACTIVE'
        AND GR.CHARGE_TYPE_RD = 'PRIMARY'
        AND SS.PRODUCT_SUBSCRIPTION_ID = PS.PRODUCT_SUBSCRIPTION_ID 
        AND PS.EFFECTIVE_FLAG = 'N' AND PS.EFFECTIVE_STATUS = 'ACTIVE' 
        AND PS.PRODUCT_COMMITMENT_NUMBER = PC.PRODUCT_COMMITMENT_NUMBER 
        AND PC.EFFECTIVE_FLAG = 'N' AND PC.EFFECTIVE_STATUS = 'ACTIVE'
        AND PROD.PRODUCT_CODE = PC.PRODUCT_CODE 
        AND PROD.PRODUCT_VERSION_CODE =  PC.PRODUCT_VERSION_CODE 
        AND PRICING.PRICING_STRUCTURE_CODE = PC.PRICING_STRUCTURE_CODE 
        AND PRICING.PRODUCT_CODE = PC.PRODUCT_CODE 
        AND PRICING.PRODUCT_VERSION_CODE = PC.PRODUCT_VERSION_CODE 
        AND PS.CUSTOMER_NUMBER = C.CUSTOMER_NUMBER 
        AND PC.STATE_RD = 'SIGNED'
    </select>

    <select id = "GetCodbPrerequisiteData.effonl.RetrieveTariffOptions" parameterClass = "String" resultClass="java.util.HashMap">
	SELECT /* GetCodbPrerequisiteData.effonl.RetrieveTariffOptions */   S.NAME
        FROM 
            SERVICE_SUBSCRIPTION SS,
            SERVICE_SUBSCRIPTION_DEP SD,
            SERVICE S
        WHERE  
        SD.SERVICE_SUBSCRIPTION_DEP_ID = #value#
        AND SS.SERVICE_SUBSCRIPTION_ID = SD.SERVICE_SUBSCRIPTION_ID
        AND SS.SERVICE_CODE = S.SERVICE_CODE 
		AND SS.STATE_RD = 'SUBSCRIBED'
        AND (S.SERVICE_TYPE = 'TARIFF_OPTION' OR
             S.SERVICE_CODE IN ('I6000','I6001','I6002','I6003','I6004','I6005','I6006'))
        AND S.EFFECTIVE_DATE = ( SELECT MAX(EFFECTIVE_DATE) FROM SERVICE S1 WHERE 
                                 S.SERVICE_CODE = S1.SERVICE_CODE
                                 AND S1.EFFECTIVE_DATE &lt;= SYSDATE)
        AND S.EFFECTIVE_STATUS = 'ACTIVE'
    </select>

    <select id = "GetCodbPrerequisiteData.effonl.RetrieveAccessNumbers" parameterClass = "String" resultClass="java.util.HashMap">
        SELECT /* GetCodbPrerequisiteData.effonl.RetrieveAccessNumbers */  AN.ACCESS_NUMBER 
        FROM 
        ACCESS_NUMBER AN, CONFIG_SERVICE_CHARACTERISTIC CSC, SERVICE_SUBSCRIPTION S
        WHERE 
        CSC.SERVICE_SUBSCRIPTION_ID = #value#
        AND CSC.SERVICE_SUBSCRIPTION_ID = S.SERVICE_SUBSCRIPTION_ID
        AND S.SERVICE_CODE != 'I1043'
        AND CSC.CONFIG_SERVICE_CHAR_ID = AN.CONFIG_SERVICE_CHAR_ID
        AND CSC.EFFECTIVE_FLAG = 'N'
        AND CSC.EFFECTIVE_STATUS = 'ACTIVE'
        AND AN.TYPE_RD IN ('MAIN_ACCESS_NUM','MOBIL_ACCESS_NUM','ACC_NUM_RANGE')
        AND AN.ACCESS_NUMBER IS NOT NULL
    </select>
    
    <select id = "GetCodbPrerequisiteData.effonl.RetrieveSignedContractData" parameterClass = "String" resultClass="java.util.HashMap">
        SELECT /* GetCodbPrerequisiteData.effonl.RetrieveSignedContractData */   PC.PRODUCT_CODE, PROD.BILLING_NAME_2 AS PRODUCT_NAME, C.CLASSIFICATION_RD,
        PROD.ALT_BILLING_NAME_2 AS ALT_PRODUCT_NAME, PC.PRODUCT_VERSION_CODE, 
        PC.PRICING_STRUCTURE_CODE, PRICING.NAME AS PRICING_STRUCTURE_NAME, PC.CONTRACT_NUMBER,
        SS.SERVICE_CODE,GR.ACCOUNT_NUMBER
        FROM 
        SERVICE_SUBSCRIPTION ss,
        GUIDING_RULE GR,
        PRODUCT_SUBSCRIPTION PS, 
        PRODUCT_VERSION PROD, 
        PRICING_STRUCTURE PRICING, 
        ORDER_FORM_PRODUCT_COMMIT PC,
        CUSTOMER C  
        WHERE  
        SS.SERVICE_SUBSCRIPTION_ID = #value# 
        AND GR.SERVICE_SUBSCRIPTION_ID = #value# 
        AND GR.EFFECTIVE_FLAG = 'N'
        AND GR.EFFECTIVE_STATUS = 'ACTIVE'
        AND GR.CHARGE_TYPE_RD = 'PRIMARY'
        AND SS.PRODUCT_SUBSCRIPTION_ID = PS.PRODUCT_SUBSCRIPTION_ID 
        AND PS.EFFECTIVE_FLAG = 'N' AND PS.EFFECTIVE_STATUS = 'ACTIVE' 
        AND PS.PRODUCT_COMMITMENT_NUMBER = PC.PRODUCT_COMMITMENT_NUMBER 
        AND PC.EFFECTIVE_DATE = (SELECT MAX(EFFECTIVE_DATE) FROM ORDER_FORM_PRODUCT_COMMIT PC2 WHERE 
        PC.PRODUCT_COMMITMENT_NUMBER = PC2.PRODUCT_COMMITMENT_NUMBER AND 
        PC2.STATE_RD = 'SIGNED') 
        AND PC.EFFECTIVE_STATUS = 'ACTIVE'
        AND PROD.PRODUCT_CODE = PC.PRODUCT_CODE 
        AND PROD.PRODUCT_VERSION_CODE =  PC.PRODUCT_VERSION_CODE 
        AND PRICING.PRICING_STRUCTURE_CODE = PC.PRICING_STRUCTURE_CODE 
        AND PRICING.PRODUCT_CODE = PC.PRODUCT_CODE 
        AND PRICING.PRODUCT_VERSION_CODE = PC.PRODUCT_VERSION_CODE 
        AND PS.CUSTOMER_NUMBER = C.CUSTOMER_NUMBER 
        AND PC.STATE_RD = 'SIGNED'
    </select>
    
    <select id = "GetCodbPrerequisiteData.onl.RetrieveContractData" parameterClass = "String" resultClass="java.util.HashMap">
        SELECT /* GetCodbPrerequisiteData.onl.RetrieveContractData */   PC.PRODUCT_CODE, PROD.BILLING_NAME_2 AS PRODUCT_NAME, C.CLASSIFICATION_RD,
		PROD.ALT_BILLING_NAME_2 AS ALT_PRODUCT_NAME, PC.PRODUCT_VERSION_CODE, 
        PC.PRICING_STRUCTURE_CODE, PRICING.NAME AS PRICING_STRUCTURE_NAME, PC.CONTRACT_NUMBER,
        SS.SERVICE_CODE,GR.ACCOUNT_NUMBER
        FROM 
            SERVICE_SUBSCRIPTION ss,
            GUIDING_RULE GR,
            PRODUCT_SUBSCRIPTION PS, 
            PRODUCT_VERSION PROD, 
            PRICING_STRUCTURE PRICING, 
            ORDER_FORM_PRODUCT_COMMIT PC,
			CUSTOMER C  
        WHERE  
        SS.SERVICE_SUBSCRIPTION_ID = #value# 
        AND GR.SERVICE_SUBSCRIPTION_ID = #value# 
        AND GR.EFFECTIVE_DATE = (SELECT MAX(EFFECTIVE_DATE) FROM GUIDING_RULE GR2 WHERE
                                 GR.SERVICE_SUBSCRIPTION_ID = GR2.SERVICE_SUBSCRIPTION_ID
                                 AND GR.ACCOUNT_NUMBER = GR2.ACCOUNT_NUMBER)
        AND GR.EFFECTIVE_STATUS = 'ACTIVE'
        AND GR.CHARGE_TYPE_RD = 'PRIMARY'
        AND SS.PRODUCT_SUBSCRIPTION_ID = PS.PRODUCT_SUBSCRIPTION_ID 
        AND PS.EFFECTIVE_DATE = (SELECT MAX(EFFECTIVE_DATE) FROM PRODUCT_SUBSCRIPTION PS2 WHERE 
                        PS.PRODUCT_SUBSCRIPTION_ID = PS2.PRODUCT_SUBSCRIPTION_ID  
                        ) 
        AND PS.EFFECTIVE_STATUS = 'ACTIVE' 
        AND PS.PRODUCT_COMMITMENT_NUMBER = PC.PRODUCT_COMMITMENT_NUMBER 
        AND PC.EFFECTIVE_DATE = (SELECT MAX(EFFECTIVE_DATE) FROM ORDER_FORM_PRODUCT_COMMIT PC2 WHERE 
                         PC.PRODUCT_COMMITMENT_NUMBER = PC2.PRODUCT_COMMITMENT_NUMBER AND 
                         PC2.STATE_RD = 'SIGNED') 
        AND PC.EFFECTIVE_STATUS = 'ACTIVE'
        AND PROD.PRODUCT_CODE = PC.PRODUCT_CODE 
        AND PROD.PRODUCT_VERSION_CODE =  PC.PRODUCT_VERSION_CODE 
        AND PRICING.PRICING_STRUCTURE_CODE = PC.PRICING_STRUCTURE_CODE 
        AND PRICING.PRODUCT_CODE = PC.PRODUCT_CODE 
        AND PRICING.PRODUCT_VERSION_CODE = PC.PRODUCT_VERSION_CODE 
        AND PS.CUSTOMER_NUMBER = C.CUSTOMER_NUMBER 
        AND PC.STATE_RD = 'SIGNED'
    </select>


    <select id = "GetCodbPrerequisiteData.onl.RetrieveTariffOptions" parameterClass = "String" resultClass="java.util.HashMap">
	SELECT /* GetCodbPrerequisiteData.onl.RetrieveTariffOptions */   S.NAME
        FROM 
            SERVICE_SUBSCRIPTION SS,
            SERVICE_SUBSCRIPTION_DEP SD,
            SERVICE S
        WHERE  
        SD.SERVICE_SUBSCRIPTION_DEP_ID = #value#
        AND SS.SERVICE_SUBSCRIPTION_ID = SD.SERVICE_SUBSCRIPTION_ID
        AND SS.SERVICE_CODE = S.SERVICE_CODE 
		AND SS.STATE_RD = 'SUBSCRIBED'
        AND (S.SERVICE_TYPE = 'TARIFF_OPTION' OR
             S.SERVICE_CODE IN ('I6000','I6001','I6002','I6003','I6004','I6005','I6006'))
        AND S.EFFECTIVE_DATE = ( SELECT MAX(EFFECTIVE_DATE) FROM SERVICE S1 WHERE 
                                 S.SERVICE_CODE = S1.SERVICE_CODE
                                 AND S1.EFFECTIVE_DATE &lt;= SYSDATE)
        AND S.EFFECTIVE_STATUS = 'ACTIVE'
    </select>
    
    <select id = "GetCodbPrerequisiteData.onl.RetrieveAccessNumbers" parameterClass = "String" resultClass="java.util.HashMap">
        SELECT /* GetCodbPrerequisiteData.onl.RetrieveAccessNumbers */  AN.ACCESS_NUMBER 
        FROM 
        ACCESS_NUMBER AN, CONFIG_SERVICE_CHARACTERISTIC CSC, SERVICE_SUBSCRIPTION S 
        WHERE 
        CSC.SERVICE_SUBSCRIPTION_ID = #value#
        AND CSC.SERVICE_SUBSCRIPTION_ID = S.SERVICE_SUBSCRIPTION_ID
        AND S.SERVICE_CODE != 'I1043'
        AND CSC.CONFIG_SERVICE_CHAR_ID = AN.CONFIG_SERVICE_CHAR_ID
        AND CSC.EFFECTIVE_DATE = ( SELECT MAX(EFFECTIVE_DATE) FROM CONFIG_SERVICE_CHARACTERISTIC CSC2
                                   WHERE
                                   CSC.CONFIG_SERVICE_CHAR_ID = CSC2.CONFIG_SERVICE_CHAR_ID
                                   AND CSC2.EFFECTIVE_DATE &lt; SYSDATE)
        AND CSC.EFFECTIVE_STATUS = 'ACTIVE'
        AND AN.TYPE_RD IN ('MAIN_ACCESS_NUM','MOBIL_ACCESS_NUM','ACC_NUM_RANGE')
        AND AN.ACCESS_NUMBER IS NOT NULL
    </select>
    
</sqlMap>
                                    